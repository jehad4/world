<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Previous head content remains the same until the script section -->
    
    <!-- Add Firebase SDK -->
    <script type="module">
        // Import Firebase functions
        import { database, ref, onValue, remove, set } from './firebase.js';
        
        // DOM Elements (previous declarations remain the same)
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTransactions();
        });
        
        // Admin Panel Functions
        function loadTransactions() {
            const tbody = document.getElementById('transactionsBody');
            tbody.innerHTML = '';
            
            const transactionsRef = ref(database, 'transactions');
            onValue(transactionsRef, (snapshot) => {
                const data = snapshot.val();
                tbody.innerHTML = '';
                
                if (!data) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">No transactions found</td></tr>';
                    updateStats(0, 0, 0);
                    return;
                }
                
                let total = 0;
                let pending = 0;
                let verified = 0;
                
                // Convert object to array and sort by date (newest first)
                const transactionsArray = Object.keys(data).map(key => ({
                    id: key,
                    ...data[key]
                })).sort((a, b) => new Date(b.date) - new Date(a.date));
                
                transactionsArray.forEach(transaction => {
                    total++;
                    if (transaction.status === 'pending') pending++;
                    if (transaction.status === 'verified') verified++;
                    
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${transaction.id}</td>
                        <td>${transaction.transactionId}</td>
                        <td>${transaction.method}</td>
                        <td>${formatDate(transaction.date)}</td>
                        <td><span class="status-badge status-${transaction.status}">${transaction.status}</span></td>
                        <td>
                            ${transaction.status === 'pending' ? 
                              `<button class="action-btn verify-btn" data-id="${transaction.id}">
                                  <i class="fas fa-check"></i> Verify
                               </button>` : 
                              '<i class="fas fa-check-circle" style="color: #4CAF50;"></i> Verified'}
                            <button class="action-btn delete-btn" data-id="${transaction.id}">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(row);
                });
                
                // Add event listeners to action buttons
                document.querySelectorAll('.verify-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.dataset.id;
                        verifyTransaction(id);
                    });
                });
                
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.dataset.id;
                        deleteTransaction(id);
                    });
                });
                
                updateStats(total, pending, verified);
            });
        }
        
        async function verifyTransaction(id) {
            try {
                const transactionRef = ref(database, `transactions/${id}`);
                await set(transactionRef, {
                    ...(await get(transactionRef)).val(),
                    status: 'verified',
                    verified: true
                });
                showNotification('Transaction verified successfully!', 'success');
            } catch (error) {
                console.error("Error verifying transaction: ", error);
                showNotification('Failed to verify transaction', 'error');
            }
        }
        
        async function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                try {
                    const transactionRef = ref(database, `transactions/${id}`);
                    await remove(transactionRef);
                    showNotification('Transaction deleted successfully!', 'success');
                } catch (error) {
                    console.error("Error deleting transaction: ", error);
                    showNotification('Failed to delete transaction', 'error');
                }
            }
        }
        
        function updateStats(total, pending, verified) {
            totalTransactionsEl.textContent = total;
            pendingTransactionsEl.textContent = pending;
            verifiedTransactionsEl.textContent = verified;
        }
        
        // Clear All Transactions
        clearBtn.addEventListener('click', function() {
            if (confirm('Are you sure you want to clear ALL transactions? This cannot be undone.')) {
                const transactionsRef = ref(database, 'transactions');
                remove(transactionsRef)
                    .then(() => showNotification('All transactions cleared!', 'success'))
                    .catch(error => {
                        console.error("Error clearing transactions: ", error);
                        showNotification('Failed to clear transactions', 'error');
                    });
            }
        });
        
        // Rest of your existing functions remain the same
    </script>
</body>
</html>
